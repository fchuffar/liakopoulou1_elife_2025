# liakopoulou1_elife_2025

A set of scripts that orchestrates the analysis of ATAC-Seq and RNA-seq data of [Liakopoulou et al., elife, 2025].


# 1. Set parameters there and in *config* file. 
## The two main setable parameters are *project* (the global project) *gse* (the batch/run of fastq files)
cd ~/projects/mouse_spermato/results/liakopoulou1_elife_2025
source config
echo $gse
echo $project
## push to dahu
rsync -auvP ~/projects/${project}/results/${gse}/ dahu:~/projects/${project}/results/${gse}/



# 2. Download fastq files from NCBI/GEO 
# ## download preproc NCBI/SRA db
if [ -f "SRA_Accessions.tab" ]; then
    echo "SRA_Accessions.tab file exists."
else
    ## downloading...
    wget https://ftp.ncbi.nlm.nih.gov/sra/reports/Metadata/SRA_Accessions.tab
    ## preprocessing...
    cat SRA_Accessions.tab | grep GSE277943
    cat SRA_Accessions.tab | grep GSE283879
    cat SRA_Accessions.tab | grep GSE284749

    cat SRA_Accessions.tab | grep SRA | grep RUN > SRA_Accessions_SRA_RUN.tab
    cat SRA_Accessions.tab | grep SRA | grep GSE > SRA_Accessions_SRA_GSE.tab
    cat SRA_Accessions.tab | grep SRP | grep GSE > SRA_Accessions_SRP_GSE.tab
fi
# sra=`cat ~/projects/datashare/platforms/SRA_Accessions_SRA_GSE.tab | grep ${gse} | cut -f2 | grep SRA | uniq`
cat SRA_Accessions_SRP_GSE.tab | grep GSE277943 | cut -f1 | grep SRP | uniq`
srp=`cat SRA_Accessions_SRP_GSE.tab | grep GSE283879 | cut -f1 | grep SRP | uniq`
srp=`cat SRA_Accessions_SRP_GSE.tab | grep GSE284749 | cut -f1 | grep SRP | uniq`



GSE277943	ATAD2 drives HIRA/histone H3.3-dependent chromatin dynamics	24	Sep 24, 2024	Approved	Public	Jan 05, 2026
GSE283879	ATAD2 drives HIRA/histone H3.3-dependent chromatin dynamics	12	Dec 09, 2024	Approved	Public	Jan 05, 2026
GSE284749	Control of Post-Meiotic Gene Expression by H2A.L.2



echo $srp
if [[ -f ~/projects/datashare/platforms/SRA_Accessions_${srp}.tab ]]; then
   echo "File ~/projects/datashare/platforms/SRA_Accessions_${srp}.tab exists."
else
  # cat ~/projects/datashare/platforms/SRA_Accessions_SRA_RUN.tab | grep ${sra} > ~/projects/datashare/platforms/SRA_Accessions_${sra}.tab
  cat ~/projects/datashare/platforms/SRA_Accessions_SRP_RUN.tab | grep ${srp} > ~/projects/datashare/platforms/SRA_Accessions_${srp}.tab
fi
srrs=`cat ~/projects/datashare/platforms/SRA_Accessions_${srp}.tab | grep RUN | grep ${srp} | cut -f1 | grep SRR`
echo $srrs
echo $srrs | wc


GSE277943	ATAD2 drives HIRA/histone H3.3-dependent chromatin dynamics	24	Sep 24, 2024	Approved	Public	Jan 05, 2026
GSE283879	ATAD2 drives HIRA/histone H3.3-dependent chromatin dynamics	12	Dec 09, 2024	Approved	Public	Jan 05, 2026
GSE284749	Control of Post-Meiotic Gene Expression by H2A.L.2



# 2. Put raw fastq file in ~/projects/datashare/${gse}/raw
# download fastq files NCBI/GEO... 
# data description
echo https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=${gse}
# ## download NCBI/SRA db
# done previously using https://github.com/fchuffar/gse2study/blob/master/01_preprocessing.sh

# If not from NCCBI/GEO, organize your raw files in datashare
mkdir -p ~/projects/datashare/${gse}/raw
cd ~/projects/datashare/${gse}/raw
# ... edit and bash design.sh


# 3. QC/Trim fastq files using 01_trim_fastq_files.py 
source ~/conda_config.sh 
conda activate mnase_env
cd ~/projects/${project}/results/${gse}/
ls -lha ~/projects/datashare/${gse}/raw/*.fastq.gz
## set targets in 01_trim_fastq_files.py, then launch pipeline on a node:
snakemake -k -s 01_trim_fastq_files.py --cores 16 -pn
## or on the dahu cluster:
snakemake -k -s 01_trim_fastq_files.py --jobs 50 --cluster "oarsub --project epimed -l nodes=1/core={threads},walltime=6:00:00 "  --latency-wait 60 -pn


# 4. Design. Link here samples and fastqz unsing .info file.
cd  /home/chuffarf/projects/datashare/${gse}
echo " -1 /home/chuffarf/projects/datashare/liakopoulou1_elife_2025/raw/s01_R_pp_R1_fastxtrimf30.fastq.gz -2 /home/chuffarf/projects/datashare/liakopoulou1_elife_2025/raw/s01_R_pp_R2_fastxtrimf30.fastq.gz " > s01_R_pp_trim30.info
echo " -1 /home/chuffarf/projects/datashare/liakopoulou1_elife_2025/raw/s02_R_pp_R1_fastxtrimf30.fastq.gz -2 /home/chuffarf/projects/datashare/liakopoulou1_elife_2025/raw/s02_R_pp_R2_fastxtrimf30.fastq.gz " > s02_R_pp_trim30.info
echo " -1 /home/chuffarf/projects/datashare/liakopoulou1_elife_2025/raw/s03_R_pp_R1_fastxtrimf30.fastq.gz -2 /home/chuffarf/projects/datashare/liakopoulou1_elife_2025/raw/s03_R_pp_R2_fastxtrimf30.fastq.gz " > s03_R_pp_trim30.info
echo " -1 /home/chuffarf/projects/datashare/liakopoulou1_elife_2025/raw/s04_R_pp_R1_fastxtrimf30.fastq.gz -2 /home/chuffarf/projects/datashare/liakopoulou1_elife_2025/raw/s04_R_pp_R2_fastxtrimf30.fastq.gz " > s04_R_pp_trim30.info
echo " -1 /home/chuffarf/projects/datashare/liakopoulou1_elife_2025/raw/s05_T_pp_R1_fastxtrimf30.fastq.gz -2 /home/chuffarf/projects/datashare/liakopoulou1_elife_2025/raw/s05_T_pp_R2_fastxtrimf30.fastq.gz " > s05_T_pp_trim30.info
echo " -1 /home/chuffarf/projects/datashare/liakopoulou1_elife_2025/raw/s06_T_pp_R1_fastxtrimf30.fastq.gz -2 /home/chuffarf/projects/datashare/liakopoulou1_elife_2025/raw/s06_T_pp_R2_fastxtrimf30.fastq.gz " > s06_T_pp_trim30.info
echo " -1 /home/chuffarf/projects/datashare/liakopoulou1_elife_2025/raw/s07_T_mm_R1_fastxtrimf30.fastq.gz -2 /home/chuffarf/projects/datashare/liakopoulou1_elife_2025/raw/s07_T_mm_R2_fastxtrimf30.fastq.gz " > s07_T_mm_trim30.info
echo " -1 /home/chuffarf/projects/datashare/liakopoulou1_elife_2025/raw/s08_T_mm_R1_fastxtrimf30.fastq.gz -2 /home/chuffarf/projects/datashare/liakopoulou1_elife_2025/raw/s08_T_mm_R2_fastxtrimf30.fastq.gz " > s08_T_mm_trim30.info
echo " -1 /home/chuffarf/projects/datashare/liakopoulou1_elife_2025/raw/s09_R_mm_R1_fastxtrimf30.fastq.gz -2 /home/chuffarf/projects/datashare/liakopoulou1_elife_2025/raw/s09_R_mm_R2_fastxtrimf30.fastq.gz " > s09_R_mm_trim30.info
echo " -1 /home/chuffarf/projects/datashare/liakopoulou1_elife_2025/raw/s10_R_mm_R1_fastxtrimf30.fastq.gz -2 /home/chuffarf/projects/datashare/liakopoulou1_elife_2025/raw/s10_R_mm_R2_fastxtrimf30.fastq.gz " > s10_R_mm_trim30.info
echo " -1 /home/chuffarf/projects/datashare/liakopoulou1_elife_2025/raw/s11_R_mm_R1_fastxtrimf30.fastq.gz -2 /home/chuffarf/projects/datashare/liakopoulou1_elife_2025/raw/s11_R_mm_R2_fastxtrimf30.fastq.gz " > s11_R_mm_trim30.info
echo " -1 /home/chuffarf/projects/datashare/liakopoulou1_elife_2025/raw/s12_R_mm_R1_fastxtrimf30.fastq.gz -2 /home/chuffarf/projects/datashare/liakopoulou1_elife_2025/raw/s12_R_mm_R2_fastxtrimf30.fastq.gz " > s12_R_mm_trim30.info

cat  *_trim30.info

cd ~/projects/${project}/results/${gse}/
cat config.R



## 5. Align and wiggle
cd ~/projects/${project}/results/${gse}/
## set targets in 02_align_fastq_files.py, then launch pipeline on a node:
snakemake -k -s 02_align_fastq_files.py --cores 16 -pn
## or on the dahu cluster:
snakemake -k -s 02_align_fastq_files.py --jobs 50 --cluster "oarsub --project epimed -l nodes=1/core={threads},walltime=6:00:00 "  --latency-wait 60 -pn

# 6. 03_metagene.Rmd and so on
source ~/conda_config.sh 
conda activate mnase_env
## set samples in the config.R file then under R:
rmarkdown::render("03_metagene_trscr2chrom_cust.Rmd")

